/* pytesNET/tail.select v.0.5.15 | ES6 Version | @author SamBrishes, pytesNET <sam@pytes.net> | @license MIT */
var{select,options}=function(a){function b(a,b){let d=c.createElement(a);return d.className=b&&b.join?b.join(" "):b||"",d}const c=a.document,d="querySelector",e="querySelectorAll",f="parentElement",g="hasAttribute",h="getAttribute",i="setAttribute",j="removeAttribute",k=function(a,b){if(a="string"==typeof a?c[e](a):a,a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array){let c=Array.prototype.map.call(a,a=>new k(a,Object.assign({},b)));return 1===c.length?c[0]:0!==c.length&&c}if(!(a instanceof Element)||!(this instanceof k))return!!(a instanceof Element)&&new k(a,b);if(k.inst[a[h]("data-tail-select")])return k.inst[a[h]("data-tail-select")];if(a[h]("data-select")){let c=JSON.parse(a[h]("data-select").replace(/\'/g,"\""));b=c instanceof Object?Object.assign(b,c):b}let d=a[h]("placeholder")||a[h]("data-placeholder");return b="object"==typeof b?b:{},b.multiple="multiple"in b?b.multiple:a.multiple,b.disabled="disabled"in b?b.disabled:a.disabled,b.placeholder=d||b.placeholder||null,b.width="auto"===b.width?a.offsetWidth+50:b.width,b.sourceBind="bindSourceSelect"in b?b.bindSourceSelect:b.sourceBind||!1,b.sourceHide="sourceHide"in b?b.sourceHide:b.sourceHide||!0,b.multiLimit=0<=b.multiLimit?b.multiLimit:1/0,this.e=a,this.id=++k.count,this.con=Object.assign({},k.defaults,b),this.events={},k.inst["tail-"+this.id]=this,this.init().bind()};k.version="0.5.15",k.status="experimental",k.count=0,k.inst={},k.defaults={animate:!0,classNames:null,csvOutput:!1,csvSeparator:",",descriptions:!1,deselect:!1,disabled:!1,height:350,hideDisabled:!1,hideSelected:!1,items:{},locale:"en",linguisticRules:{ะต:"\u0451",a:"\xE4",o:"\xF6",u:"\xFC",ss:"\xDF"},multiple:!1,multiLimit:1/0,multiPinSelected:!1,multiContainer:!1,multiShowCount:!0,multiShowLimit:!1,multiSelectAll:!1,multiSelectGroup:!0,openAbove:null,placeholder:null,search:!1,searchConfig:["text","value"],searchFocus:!0,searchMarked:!0,searchMinLength:1,searchDisabled:!0,sortItems:!1,sortGroups:!1,sourceBind:!1,sourceHide:!0,startOpen:!1,stayOpen:!1,width:null,cbComplete:void 0,cbEmpty:void 0,cbLoopItem:void 0,cbLoopGroup:void 0},k.strings={de:{all:"Alle",none:"Keine",actionAll:"Alle ausw\xE4hlen",actionNone:"Alle abw\xE4hlen",empty:"Keine Optionen verf\xFCgbar",emptySearch:"Keine Optionen gefunden",limit:"Keine weiteren Optionen w\xE4hlbar",placeholder:"W\xE4hle eine Option...",placeholderMulti:"W\xE4hle bis zu :limit Optionen...",search:"Tippen zum suchen",disabled:"Dieses Feld ist deaktiviert"},en:{all:"All",none:"None",actionAll:"Select All",actionNone:"Unselect All",empty:"No Options available",emptySearch:"No Options found",limit:"You can't select more Options",placeholder:"Select an Option...",placeholderMulti:"Select up to :limit Options...",search:"Type in to search...",disabled:"This Field is disabled"},es:{all:"Todos",none:"Ninguno",actionAll:"Seleccionar todo",actionNone:"Descartar todo",empty:"No hay opciones disponibles",emptySearch:"No se encontraron opciones",limit:"No puedes seleccionar mas opciones",placeholder:"Selecciona una opci\xF3n...",placeholderMulti:"Selecciona hasta :l\xEDmite de opciones...",search:"Escribe dentro para buscar...",disabled:"Este campo esta deshabilitado"},fi:{all:"Kaikki",none:"Ei mit\xE4\xE4n",actionAll:"Valitse kaikki",actionNone:"Poista kaikki valinnat",empty:"Ei vaihtoehtoja",emptySearch:"Etsim\xE4\xE4si vaihtoehtoa ei l\xF6ytynyt",limit:"Muita vaihtoehtoja ei voi valita",placeholder:"Valitse...",placeholderMulti:"Valitse maksimissaan :limit...",search:"Hae t\xE4st\xE4...",disabled:"Kentt\xE4 on poissa k\xE4yt\xF6st\xE4"},fr:{all:"Tous",none:"Aucun",actionAll:"S\xE9lectionner tout",actionNone:"S\xE9lectionner aucun",empty:"Aucune option disponible",emptySearch:"Aucune option trouv\xE9e",limit:"Aucune autre option s\xE9lectionnable",placeholder:"Choisissez une option ...",placeholderMulti:"Choisissez jusqu'\xE0 :limit option(s) ...",search:"Rechercher ...",disabled:"Ce champs est d\xE9sactiv\xE9"},it:{all:"Tutti",none:"Nessuno",actionAll:"Seleziona Tutto",actionNone:"Deseleziona Tutto",empty:"Nessuna voce disponibile",emptySearch:"Nessuna voce trovata",limit:"Non puoi selezionare pi\xF9 Voci",placeholder:"Seleziona una Voce",placeholderMulti:"Selezione limitata a :limit Voci...",search:"Digita per cercare...",disabled:"Questo Campo \xE8 disabilitato"},no:{all:"Alle",none:"Ingen",actionAll:"Velg alle",actionNone:"Velg ingen",empty:"Ingen valg tilgjengelig",emptySearch:"Ingen valg funnet",limit:"Du kan ikke velge flere",placeholder:"Velg...",placeholderMulti:"Velg opptil :limit...",search:"S\xF8k...",disabled:"Dette feltet er deaktivert"},pt_BR:{all:"Todas",none:"Nenhuma",actionAll:"Selecionar todas",actionNone:"Desmarcar todas",empty:"Nenhuma op\xE7\xE3o dispon\xEDvel",emptySearch:"Nenhuma op\xE7\xE3o encontrada",limit:"N\xE3o \xE9 poss\xEDvel selecionar outra op\xE7\xE3o",placeholder:"Escolha uma op\xE7\xE3o ...",placeholderMulti:"Escolha at\xE9: :limit op\xE7\xE3o(\xF5es) ...",search:"Buscar ...",disabled:"Campo desativado"},ru:{all:"\u0412\u0441\u0435",none:"\u041D\u0438\u0447\u0435\u0433\u043E",actionAll:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0432\u0441\u0435",actionNone:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0432\u0441\u0435",empty:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u043E\u0432",emptySearch:"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E",limit:"\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0431\u043E\u043B\u044C\u0448\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u043E\u0432",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0430\u0440\u0438\u0430\u043D\u0442...",placeholderMulti:function(a){let b=a[":limit"],c=["\u0432\u0430\u0440\u0438\u0430\u043D\u0442\u0430","\u0432\u0430\u0440\u0438\u0430\u043D\u0442\u043E\u0432","\u0432\u0430\u0440\u0438\u0430\u043D\u0442\u043E\u0432"][4<b%100&&20>b%100?2:[2,0,1,1,1,2][5>b%10?b%10:5]];return"\u0412\u044B\u0431\u043E\u0440 \u0434\u043E :limit "+c+" ..."},search:"\u041D\u0430\u0447\u043D\u0438\u0442\u0435 \u043D\u0430\u0431\u0438\u0440\u0430\u0442\u044C \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430 ...",disabled:"\u041F\u043E\u043B\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u043E"},tr:{all:"T\xFCm\xFC",none:"Hi\xE7biri",actionAll:"T\xFCm\xFCn\xFC Se\xE7",actionNone:"Hi\xE7birini Se\xE7me",empty:"Se\xE7enek yok",emptySearch:"Se\xE7enek bulunamad\u0131",limit:"Daha fazla Se\xE7enek se\xE7emezsiniz",placeholder:"Bir Se\xE7enek se\xE7in...",placeholderMulti:"En fazla :limit Se\xE7enek se\xE7in...",search:"Aramak i\xE7in yaz\u0131n...",disabled:"Bu Alan kullan\u0131lamaz"},modify(a,b,c){if(!(a in this))return!1;if(b instanceof Object)for(let c in b)this.modify(a,c,b[c]);else this[a][b]="string"==typeof c?c:this[a][b];return!0},register(a,b){return!!("string"==typeof a&&b instanceof Object)&&(this[a]=b,!0)}},k.prototype={_e(a,b,c){if(!(a in this.__))return c?c:a;if(a=this.__[a],"function"==typeof a&&(a=a.call(this,b)),"object"==typeof b)for(let c in b)a=a.replace(c,b[c]);return a},init(){let a=["tail-select"],g=this.con,h=/^[0-9.]+(?:cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|\%)$/i;return this.__=Object.assign({},k.strings.en,k.strings[g.locale]||{}),this._init=!0,this._query=!1,a=a.concat(!0===g.classNames?this.e.className:g.classNames),g.hideSelected&&a.push("hide-selected"),g.hideDisabled&&a.push("hide-disabled"),0==g.multiLimit&&a.push("disabled"),g.multiple&&a.push("multiple"),g.deselect&&a.push("deselect"),g.disabled&&a.push("disabled"),this.select=b("DIV",a),null===this.e.getAttribute("tabindex")?this.select.setAttribute("tabindex",0):this.select.setAttribute("tabindex",this.e.getAttribute("tabindex")),g.width&&h.test(g.width)?this.select.style.width=g.width:g.width&&!isNaN(parseFloat(g.width,10))&&(this.select.style.width=g.width+"px"),this.label=b("DIV","select-label"),this.label.addEventListener("click",()=>{this.toggle()}),this.select.appendChild(this.label),this.dropdown=b("DIV","select-dropdown"),isNaN(parseInt(g.height,10))||(this.dropdown.style.maxHeight=parseInt(g.height,10)+"px"),g.search&&(this.search=b("DIV","dropdown-search"),this.search.innerHTML=`<input type="text" class="search-input" placeholder="${this._e("search")}" />`,this.search.children[0].addEventListener("input",a=>{this.query(a.target.value.length>g.searchMinLength?a.target.value:void 0)}),this.dropdown.appendChild(this.search)),this.select.appendChild(this.dropdown),this.csvInput=b("INPUT","select-search"),this.csvInput.type="hidden",g.csvOutput&&(this.csvInput.name=this.e.name,this.e[j]("name"),this.select.appendChild(this.csvInput)),g.multiple&&g.multiContainer&&(c[d](g.multiContainer)?(this.container=c[d](g.multiContainer),this.container.classList.add("tail-select-container")):!0===g.multiContainer&&(this.container=this.label,this.container.classList.add("tail-select-container"))),this.options=new l(this.e,this),Array.prototype.map.call(this.e.options,a=>{this.options.set(a,!1)}),Object.keys(g.items).forEach(f=>{let h=g.items[f].join?g.items[f]:{value:g.items[f]},{value:i,group:a,selected:b,disabled:c,description:d}=h;this.options.add(g.items[f].key||f,i,a,b,c,d)}),this.query(),this.e.nextElementSibling?this.e[f].insertBefore(this.select,this.e.nextElementSibling):this.e[f].appendChild(this.select),g.sourceHide&&("none"==this.e.style.display?(this.select.style.display="none",this.e.setAttribute("data-select-hidden","display")):"hidden"==this.e.style.visibility?(this.select.style.visibiltiy="hidden",this.e.setAttribute("data-select-hidden","visibility")):(this.e.style.display="none",this.e.setAttribute("data-select-hidden","0"))),this._init=!1,this.e[i]("data-tail-select","tail-"+this.id),(g.cbComplete||function(){}).call(this,this.select),g.startOpen?this.open(this.con.animate):this},bind(){return(c.addEventListener("keydown",a=>{let b,c,g,h,i,j=a.keyCode||a.which,k=32==j&&self.select===document.activeElement;if(!k||!this.select.classList.contains("active")||0>[13,27,38,40].indexOf(j))return!1;if(a.preventDefault(),a.stopPropagation(),32===j)return this.open(self.con.animate);if(13==j&&(b=this.dropdown[d](".dropdown-option.hover:not(.disabled)"))&&this.options.select(b),27==j||13==j)return this.close(this.con.animate);if(b=this.dropdown[d](".dropdown-option.hover:not(.disabled)")){b.classList.remove("hover"),g=[(40==j?"next":"previous")+"ElementSibling"];do{if(b=null!==(h=b[g])&&"LI"==b.tagName?h:!!(null!==(h=b[f][g])&&0<h.children.length&&"UL"==h.tagName)&&h.children[40==j?0:h.children.length-1],b&&(!/dropdown-option/.test(b.className)||/disabled/.test(b.className)))continue;break}while(!0)}if(b||40!=j?!b&&38==j&&(i=self.dropdown.querySelectorAll(".dropdown-option:not(.disabled)"),b=i[i.length-1]):b=this.dropdown[d](".dropdown-option:not(.disabled)"),b&&(c=this.dropdown[d](".dropdown-inner"))){let a=function(a){let b={top:a.offsetTop,height:a.offsetHeight};for(;(a=a[f])!=c;)b.top+=a.offsetTop;return b}(b);b.classList.add("hover"),a.top+2*a.height>c.offsetHeight+c.scrollTop?c.scrollBy(0,a.top+2*a.height-(c.offsetHeight+c.scrollTop)):a.top-a.height<c.scrollTop&&c.scrollBy(0,-Math.abs(c.scrollTop-a.top+a.height))}return!0}),c.addEventListener("click",a=>{let b=!this.select.classList.contains("active")||this.select.classList.contains("idle");if(b||this.con.stayOpen)return!1;let c=[this.e,this.select,this.container].filter(b=>b&&(b.contains(a.target)||b==a.target));return 0==c.length&&this.close(this.con.animate)}),!!!this.con.sourceBind)||(this.e.addEventListener("change",()=>{if(null!=event.detail)return!1;if(event.preventDefault(),event.stopPropagation(),!this.multiple&&this.selectedIndex)this.options.select(this.e.options[this.selectedIndex]);else{let a=[].concat(self.options.selected),b=Array.from(this.e[e]("option:checked")).filter(b=>!(0<=a.indexOf(b))||(a.splice(a.indexOf(b),1),!1));this.options.walk("unselect",a),this.options.walk("select",b)}}),!0)},callback(a,b,c){let e=a.key.replace(/('|\\)/g,"\\$1"),f=a.group.replace(/('|\\)/g,"\\$1");if("rebuild"==b)return this.query();let g=this.dropdown[d](`[data-key='${e}'][data-group='${f}']`);return g&&0<=["select","disable"].indexOf(b)?g.classList.add("select"==b?"selected":"disabled"):g&&0<=["unselect","enable"].indexOf(b)&&g.classList.remove("unselect"==b?"selected":"disabled"),this.update(a),!!c||this.trigger("change",a,b)},trigger(a){if(this._init)return!1;let b={bubbles:!1,cancelable:!0,detail:{args:arguments,self:this}};"change"==a&&arguments[2]&&0<=arguments[2].indexOf("select")&&(this.e.dispatchEvent(new CustomEvent("input",b)),this.e.dispatchEvent(new CustomEvent("change",b))),this.select.dispatchEvent(new CustomEvent("tail::"+a,b));let c,d=[...arguments];return d.shift(),(this.events[a]||[]).forEach(a=>{c=[].concat(d),c.push(a.args||null),(a.cb||function(){}).apply(this,c)}),!0},calc(){let b=this.dropdown.cloneNode(!0),c=this.con.height,e=0,g=this.dropdown[d](".dropdown-inner");b=this.dropdown.cloneNode(!0),b.style.cssText="height:auto;min-height:auto;max-height:none;opacity:0;display:block;visibility:hidden;",b.style.maxHeight=this.con.height+"px",b.className+=" cloned",this.dropdown[f].appendChild(b),c=c>b.clientHeight?b.clientHeight:c,this.con.search&&(e=b[d](".dropdown-search").clientHeight),this.dropdown[f].removeChild(b);let h=this.select.getBoundingClientRect(),i=a.innerHeight-(h.top+h.height),j=!!(c+e>i)&&h.top>i;return!0===this.con.openAbove||!1!==this.con.openAbove&&j?(j=!0,c=Math.min(c,h.top-10),this.select.classList.add("open-top")):(j=!1,c=Math.min(c,i-10),this.select.classList.remove("open-top")),g&&(this.dropdown.style.maxHeight=c+"px",g.style.maxHeight=c-e+"px"),this},query(a,c){let f,g,j,k,l=this.con,n=b("DIV","dropdown-inner"),o=a?"finder":"walker",p=a?[a,c]:[l.sortItems,l.sortGroups];this._query="string"==typeof a&&a;for(let b of this.options[o].apply(this.options,p)){if(!1===b)continue;if(!g||g&&g[h]("data-group")!==b.group)if(f=(l.cbLoopGroup||this.cbGroup).call(this,b.group,a,n),f instanceof Element)g=f,g[i]("data-group",b.group),n.appendChild(g);else break;let c=(l.cbLoopItem||this.cbItem).call(this,b,g,a,n);if(null!==c){if(!1===c)break;c[i]("data-key",b.key),c[i]("data-group",b.group),c.addEventListener("click",()=>!!c[h]("data-key")&&void(this.options.toggle(c[h]("data-key"),c[h]("data-group"))&&!l.stayOpen&&!l.multiple&&this.close(this.con.animate))),g.appendChild(c)}}let q=n[e]("*[data-key]").length;if(0==q&&(this.con.cbEmpty||function(a){let c=b("SPAN","dropdown-empty");c.innerText=this._e("empty"),a.appendChild(c)}).call(this,n,a),0<q&&l.multiple&&l.multiLimit==1/0&&l.multiSelectAll){j=b("BUTTON","tail-all"),k=b("BUTTON","tail-none"),j.innerText=this._e("actionAll"),j.addEventListener("click",a=>{a.preventDefault(),this.options.walk("select",this.dropdown.querySelectorAll(".dropdown-inner .dropdown-option"))}),k.innerText=this._e("actionNone"),k.addEventListener("click",a=>{a.preventDefault(),this.options.walk("unselect",this.dropdown.querySelectorAll(".dropdown-inner .dropdown-option"))});let a=b("SPAN","dropdown-action");a.appendChild(j),a.appendChild(k),n.insertBefore(a,n.children[0])}let r=this.dropdown[d](".dropdown-inner");return this.dropdown[(r?"replace":"append")+"Child"](n,r),this.select.classList.contains("active")&&this.calc(),this.updateCSV().updateLabel()},cbGroup(a,c){let d,e,g=b("UL","dropdown-optgroup"),i=this;return"#"==a?g:(g.innerHTML=`<li class="optgroup-title"><b>${a}</b></li>`,this.con.multiple&&this.con.multiLimit==1/0&&this.con.multiSelectAll&&(d=b("BUTTON","tail-none"),e=b("BUTTON","tail-all"),d.innerText=this._e("none"),d.addEventListener("click",a=>{a.preventDefault(),this.options.all("unselect",a.target[f][f][h]("data-group"))}),e.innerText=this._e("all"),e.addEventListener("click",a=>{a.preventDefault(),this.options.all("select",a.target[f][f][h]("data-group"))}),g.children[0].appendChild(d),g.children[0].appendChild(e)),g)},cbItem(a,c,e){let{value:f,selected:g,disabled:h}=a,d=b("LI","dropdown-option"+(g?" selected":"")+(h?" disabled":""));return e&&0<e.length&&this.con.searchMarked?(e=this.options.applyLinguisticRules(e),d.innerHTML=f.replace(new RegExp(`(${e})`,"i"),"<mark>$1</mark>")):d.innerText=f,this.con.descriptions&&a.description&&(d.innerHTML+=`<span class="option-description">${a.description}</span>`),d},update(a){return this.updateLabel().updateContainer(a).updatePin(a).updateCSV(a)},updateLabel(a){if(this.container==this.label&&0<this.options.selected.length)return this.label[d](".label-inner")&&this.label.removeChild(this.label[d](".label-inner")),this.label[d](".label-count")&&this.label.removeChild(this.label[d](".label-count")),this;let b,f=this.con,c=this.options.selected.length;return"string"!=typeof a&&(f.disabled?a="disabled":0==this.dropdown[e]("*[data-key]").length?a="empty"+(this.select.classList.contains("in-search")?"Search":""):f.multiLimit<=c?a="limit":!f.multiple&&0<this.options.selected.length?a=this.options.selected[0].innerText:"string"==typeof f.placeholder?a=f.placeholder:a="placeholder"+(f.multiple&&f.multiLimit<1/0?"Multi":"")),a=this._e(a,{":limit":f.multiLimit},a),a=`<span class="label-inner">${a}</span>`,b=f.multiShowLimit&&f.multiLimit<1/0,f.multiple&&f.multiShowCount&&(a=`<span class="label-count">:c</span>\n${a}`,a=a.replace(":c",c+(b?" / "+f.multiLimit:""))),this.label.innerHTML=a,this},updateContainer(a){if(!this.container||!this.con.multiContainer)return this;let c=`[data-group='${a.group}'][data-key='${a.key}']`;if(this.container[d](c))return a.selected||this.container.removeChild(this.container[d](c)),this;if(a.selected){let c=b("DIV","select-handle");c.innerText=a.value,c[i]("data-key",a.key),c[i]("data-group",a.group),c.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),this.options.unselect(a.target[h]("data-key"),a.target[h]("data-group"))}),this.container.appendChild(c)}return this},updatePin(a){let b=this.dropdown[d](".dropdown-inner ul");if(!this.con.multiPinSelected||!b||!1!==this._query)return this;if(option=this.dropdown[d](`li[data-key='${a.key}'][data-group='${a.group}']`),a.selected)b.insertBefore(option,b.children[0]);else{let b=this.dropdown[d](`ul[data-group='${a.group}']`),c=this.options[a.index-1],e=!1;for(;c&&c.group==a.group&&!(e=b[d](`li[data-key='${c.key}']`));)c=this.options[c.index-1];e&&e.nextElementSibling?b.insertBefore(option,e.nextElementSibling):b.appendChild(option)}return this},updateCSV(a){if(!this.csvInput||!this.con.csvOutput)return this;let b=this.options.selected.map(a=>a.value);return this.csvInput.value=b.join(this.con.csvSeparator||","),this},open(a){if(/active|idle/.test(this.select.className)||this.con.disabled)return!1;this.calc();let b=function(){this.select.classList.add("active"),this.select.classList.remove("idle"),this.dropdown.style.height="auto",this.dropdown.style.overflow="visible",this.label[j]("style"),this.con.search&&this.con.searchFocus&&this.dropdown[d]("input").focus(),this.trigger.call(this,"open")},c=this,f=this.dropdown.style;if(this.con.animate&&!1!==a){this.label.style.zIndex=25,this.dropdown.style.cssText+="height:0;display:block;overflow:hidden;",this.select.classList.add("idle");let a=()=>{let d=parseInt(f.height,10),e=parseInt(f.maxHeight,10);return d>=e?b.call(c):void(f.height=(d+50>e?e:d+50)+"px",setTimeout(a,20))};a()}else f.cssText=`height:${f.maxHeight};display:block;overflow:hidden;`,b.call(this);return this},close(a){if(!this.select.classList.contains("active")||this.select.classList.contains("idle"))return!1;let b=function(){this.select.classList.remove("idle","active"),this.dropdown[j]("style"),this.dropdown[d](".dropdown-inner")[j]("style"),this.trigger.call(this,"close")},c=this,f=this.dropdown;if(this.con.animate&&!1!==a){this.select.classList.add("idle"),this.dropdown.style.overflow="hidden";let a=()=>0>=parseInt(f.offsetHeight,10)-50?b.call(c):void(f.style.height=parseInt(f.offsetHeight,10)-50+"px",setTimeout(a,20));a()}else b.call(this);return this},toggle(a){return this.select.classList.contains("active")?this.close(a):this.select.classList.contains("idle")?this:this.open(a)},remove(){return this.e[j]("data-tail-select"),this.e[g]("data-select-hidden")&&("0"==this.e[h]("data-select-hidden")&&this.e.style.removeProperty("display"),this.e[j]("data-select-hidden")),Array.from(this.e[e]("[data-select-option='add']"),a=>{a.parentElement.removeChild(a)}),Array.from(this.e[e]("[data-select-optgroup='add']"),a=>{a.parentElement.removeChild(a)}),this.e.name=this.csvInput.hasAttribute("name")?this.csvInput.name:this.e.name,this.select[f].removeChild(this.select),this.container&&Array.from(this.container[e](".select-handle"),a=>{a.parentElement.removeChild(a)}),this},reload(){return this.remove().init()},config(a,b,c){if(a instanceof Object){for(let b in a)this.config(b,a[b],!1);return this.reload()?this.con:this.con}return"undefined"==typeof a?this.con:!!(a in this.con)&&("undefined"==typeof b?this.con[a]:(this.con[a]=b,!1!==c&&this.reload(),this))},enable(a){return this.select.classList.remove("disabled"),this.e.disabled=!1,this.con.disabled=!1,!1===a?this:this.reload()},disable(a){return this.select.classList.add("disabled"),this.e.disabled=!0,this.con.disabled=!0,!1===a?this:this.reload()},on(a,b,c){return!(0>["open","close","change"].indexOf(a)||"function"!=typeof b)&&(a in this.events||(this.events[a]=[]),this.events[a].push({cb:b,args:c instanceof Array?c:[]}),this)},value(){return 0==this.options.selected.length?null:this.con.multiple?this.options.selected.map(a=>a.value):this.options.selected[0].value}};const l=k.options=function(a,b){return this instanceof l?(this.self=b,this.element=a,this.length=0,this.selected=[],this.disabled=[],this.items={"#":{}},this.groups={},this):new l(a,b)};return l.prototype={_r(a){return a.replace("disabled","disable").replace("enabled","enable").replace("selected","select").replace("unselected","unselect")},get(a,b){if("object"==typeof a&&a.key&&a.group)b=a.group||b,a=a.key;else if(a instanceof Element)"OPTION"==a.tagName?(b=a[f].label||"#",a=a.value||a.innerText):a[g]("data-key")&&(b=a[h]("data-group")||a[f][h]("data-group")||"#",a=a[h]("data-key"));else if("string"!=typeof a)return!1;return a=/^[0-9]+$/.test(a)?"_"+a:a,!!(b in this.items)&&this.items[b][a]},set(a,c){let d=a.value||a.innerText,e=a[f].label||"#";if(e in this.items||(this.items[e]={},this.groups[e]=a[f]),d in this.items[e])return!1;let j=/^[0-9]+$/.test(d)?"_"+d:d,k=this.self.con;if(k.multiple&&this.selected.length>=k.multiLimit&&(a.selected=!1),a.selected&&k.deselect&&(!a[g]("selected")||0==k.multiLimit)&&(a.selected=!1,a.parentElement.selectedIndex=-1),a[g]("data-description")){let c=b("SPAN");c.innerHTML=a[h]("data-description"),a[i]("data-description",c.innerHTML)}return this.items[e][j]={key:d,value:a.text,description:a[h]("data-description")||null,group:e,option:a,optgroup:"#"==e?void 0:this.groups[e],selected:a.selected,disabled:a.disabled,hidden:a.hidden||!1},this.length++,a.selected&&this.select(this.items[e][j]),a.disabled&&this.disable(this.items[e][j]),!c||this.self.callback(this.items[e][d],"rebuild")},add(f,g,h,j,k,l,n){if(f instanceof Object){for(let g in f){let{value:h,group:a,selected:b,disabled:c,description:d}=f[g];this.add(f[g].key||g,h,a,b,c,d,!1)}return this.self.query()}if(this.get(f,h))return!1;if(h="string"==typeof h?h:"#","#"!==h&&!(h in this.groups)){let a=b("OPTGROUP");a.label=h,a[i]("data-select-optgroup","add"),this.element.appendChild(a),this.items[h]={},this.groups[h]=a}let o=this.self.con;o.multiple&&this.selected.length>=o.multiLimit&&(j=!1),k=!!k;let p=c.createElement("OPTION");return p.value=f,p.selected=j,p.disabled=k,p.innerText=g,p[i]("data-select-option","add"),l&&0<l.length&&p[i]("data-description",l),("#"==h?this.element:this.groups[h]).appendChild(p),this.set(p,n)},move(a,c,d,e){if(!(a=this.get(a,c)))return!1;if("#"!==d&&!(d in this.groups)){let c=b("OPTGROUP");c.label=d,this.element.appendChild(c),this.items[d]={},this.groups[d]=c,this.groups[d].appendChild(a.option)}return delete this.items[a.group][a.key],a.group=d,a.optgroup=this.groups[d]||void 0,this.items[d][a.key]=a,!e||this.self.query()},remove(a,b,c){if(!(a=this.get(a,b)))return!1;a.selected&&this.unselect(a),a.disabled&&this.enable(a),a.option[f].removeChild(a.option);let d=/^[0-9]+$/.test(a.key)?"_"+a.key:a.key;return delete this.items[a.group][d],this.length--,0===Object.keys(this.items[a.group]).length&&(delete this.items[a.group],delete this.groups[a.group]),!c||this.self.query()},is(a,b,c){return(a=this._r(a),b=this.get(b,c),!b||0>["select","unselect","disable","enable"].indexOf(a))?null:"disable"==a||"enable"==a?"disable"==a?b.disabled:!b.disabled:("select"==a||"unselect"==a)&&("select"==a?b.selected:!b.selected)},handle(a,b,c,d){if(a=this._r(a),b=this.get(b,c),!b||0>["select","unselect","disable","enable"].indexOf(a))return null;if("disable"==a||"enable"==a)return b.option in this.disabled||"disable"!=a?b.option in this.disabled&&"enable"==a&&this.disabled.splice(this.disabled.indexOf(b.option),1):this.disabled.push(b.option),b.disabled="disable"==a,b.option.disabled="disable"==a,this.self.callback.call(this.self,b,a);let e=this.self.select.classList.contains("disabled")||b.disabled||b.option.disabled,f=this.self.con.multiple&&this.self.con.multiLimit<=this.selected.length,g=!this.self.con.multiple&&0<this.selected.indexOf(b.option),h=0==this.self.con.multiLimit&&!0==this.self.con.deselect,i=!this.self.con.multiple&&!this.self.con.deselect&&!0!==d;if("select"==a){if(e||f||h||g)return!1;if(!this.self.con.multiple)for(let a in this.selected)this.unselect(this.selected[a],void 0,!0);0>this.selected.indexOf(b.option)&&this.selected.push(b.option)}else if("unselect"==a){if(e||i)return!1;this.selected.splice(this.selected.indexOf(b.option),1)}return b.selected="select"==a,b.option.selected="select"==a,b.option[(6<a.length?"remove":"set")+"Attribute"]("selected","selected"),this.self.callback.call(this.self,b,a)},enable(a,b){return this.handle("enable",a,b)},disable(a,b){return this.handle("disable",a,b)},select(a,b){return this.handle("select",a,b)},unselect(a,b,c){return this.handle("unselect",a,b,c)},toggle(a,b){return!!(a=this.get(a,b))&&this.handle(a.selected?"unselect":"select",a,b)},invert(a){if(a=this._r(a),0<=["enable","disable"].indexOf(a)){let b=this.disabled,c="enable"==a?"disable":"enable"}else if(0<=["select","unselect"].indexOf(a)){let b=this.selected,c="select"==a?"unselect":"select"}let b=Array.from(this).filter(a=>{!(a in invert)});return[].concat(invert).forEach(a=>{this.handle(action,a)}),[].concat(b).forEach(b=>{this.handle(a,b)}),!0},all(a,b){let c=this;return b in this.items?c=Object.keys(this.items[b]):0<=["unselect","enable"].indexOf(a)&&(c="unselect"==a?this.selected:this.disabled),[].concat(Array.from(c)).forEach(c=>{this.handle(a,c,b)}),!0},walk(a,b,c){if(b instanceof Array||b.length)for(let d=b.length,e=0;e<d;e++)this.handle.apply(this,[a,b[e],null].concat(c));else if(b instanceof Object)if(b.forEach)b.forEach(()=>{this.handle.apply(this,[a,value,null].concat(c))});else for(let d in b)("string"==typeof b[d]||"number"==typeof b[d]||b[d]instanceof Element)&&this.handle.apply(this,[a,b[d],d in this.items?d:null]).concat(c);return this},applyLinguisticRules(a,b){let c=this.self.con.linguisticRules,d=Object.keys(c).map(a=>"("+a+"|["+c[a]+"])");return b&&(d=d.concat(d.map(a=>a.toUpperCase()))),a.replace(new RegExp(d.join("|"),b?"g":"ig"),(a,...b)=>d[b.indexOf(a)])},find(a,b){let c,d=this,e={};if(b||(b=this.self.con.searchConfig),"function"==typeof b)c=b.bind(this,a);else{b=b instanceof Array?b:[b],b.forEach(a=>{"string"==typeof a&&(e[a]=!0)}),e.any=e.any?e.any:e.attributes&&e.value,(!e.regex||e.text)&&(a=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),e.exactglyphes||(a=this.self.options.applyLinguisticRules(a,e.case)),e.word&&(a="\\b"+a+"\\b");var f=new RegExp(a,e.case?"m":"mi"),g=a=>f.test(a.text||a.value);if(c=e.any?a=>g(a)||[...a.attributes].some(m):e.attributes?a=>[...a.attributes].some(m):g,!this.self.con.searchDisabled){let a=c;c=b=>!b.disabled&&a(b)}}return[...this.self.e.options].filter(c).map(a=>!a.hidden&&this.get(a))},*finder(a,b){for(let c,d=this.find(a,b);void 0!==(c=d.shift());)yield c},*walker(a,b){let c=Object.keys(this.groups);"ASC"==b?c.sort():"DESC"==b?c.sort().reverse():"function"==typeof b&&(c=b.call(this,c)),c.unshift("#");for(let d,e,f=c.length,g=0;g<f&&(d=c[g],!!(d in this.items));g++){e=Object.keys(this.items[d]),"ASC"==a?e.sort():"DESC"==a?e.sort().reverse():"function"==typeof a&&(e=a.call(this,e));for(let a=e.length,b=0;b<a;b++)!0!==this.items[d][e[b]].hidden&&(yield this.items[d][e[b]])}}},{select:k,options:l}}(window||this);export{select,options};
